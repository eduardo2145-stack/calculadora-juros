<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
    <meta name="description" content="Portal JurosWeb. Cotações da B3, Notícias de Economia e Simuladores de Investimento.">
    <title>JurosWeb | Portal Financeiro</title>
    
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-3C46NXBG96"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-3C46NXBG96');
    </script>

    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2032917726612847" crossorigin="anonymous"></script>
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <style>
        :root { --primary: #004494; --primary-light: #0056b3; --accent: #00d26a; --text: #333; --bg: #f4f6f9; --white: #ffffff; --danger: #dc3545; --warning: #e67e22; }
        
        body { font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; background-color: var(--bg); color: var(--text); margin: 0; padding: 0; line-height: 1.6; }
        
        /* TICKER */
        .stock-ticker-wrap { background: #003366; color: white; overflow: hidden; height: 40px; line-height: 40px; position: relative; border-bottom: 1px solid rgba(255,255,255,0.1); }
        .stock-ticker { display: inline-block; white-space: nowrap; animation: ticker 120s linear infinite; padding-left: 100%; }
        .stock-ticker-wrap:hover .stock-ticker { animation-play-state: paused; }
        .stock-item { display: inline-block; margin-right: 60px; font-weight: 500; font-size: 0.85rem; }
        .stock-up { color: #00d26a; font-weight: bold; }
        .stock-down { color: #ff6b6b; font-weight: bold; }
        @keyframes ticker { 0% { transform: translate3d(0, 0, 0); } 100% { transform: translate3d(-100%, 0, 0); } }

        /* MENU PORTAL */
        header { background: var(--primary); box-shadow: 0 4px 15px rgba(0,0,0,0.1); padding: 15px 0; margin-bottom: 30px; }
        .header-content { max-width: 1100px; margin: 0 auto; display: flex; align-items: center; justify-content: space-between; padding: 0 20px; flex-wrap: wrap; gap: 20px; }
        .logo-area { display: flex; align-items: center; gap: 10px; color: white; text-decoration: none; font-size: 1.5rem; font-weight: 800; }
        .logo-area img { height: 45px; background: white; border-radius: 8px; padding: 2px; }
        
        /* BUSCA ATIVA */
        .search-bar { background: rgba(255,255,255,0.15); padding: 8px 15px; border-radius: 50px; display: flex; align-items: center; width: 300px; border: 1px solid rgba(255,255,255,0.2); transition: 0.3s; }
        .search-bar:focus-within { background: rgba(255,255,255,0.25); border-color: rgba(255,255,255,0.5); }
        .search-bar input { background: transparent; border: none; color: white; width: 100%; outline: none; font-size: 0.9rem; }
        .search-bar input::placeholder { color: rgba(255,255,255,0.7); }
        .search-bar i { color: rgba(255,255,255,0.7); cursor: pointer; }
        .search-bar i:hover { color: white; }

        .nav-links { display: flex; gap: 25px; }
        .nav-links a { color: rgba(255,255,255,0.9); text-decoration: none; font-weight: 600; font-size: 0.95rem; transition: 0.3s; }
        .nav-links a:hover { color: white; }
        .btn-cta { background: var(--accent); color: #003366 !important; padding: 8px 20px; border-radius: 5px; font-weight: 800 !important; }
        
        .container { max-width: 1100px; margin: 0 auto; padding: 20px; }

        /* EMPRESAS */
        .companies-section { margin-top: 40px; margin-bottom: 40px; }
        .comp-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-top: 20px; }
        .comp-card { background: linear-gradient(135deg, #003366 0%, #004494 100%); color: white; border-radius: 12px; padding: 25px; display: flex; flex-direction: column; justify-content: space-between; height: 120px; transition: 0.3s; cursor: pointer; text-decoration: none; position: relative; overflow: hidden; }
        .comp-card:hover { transform: translateY(-5px); box-shadow: 0 10px 20px rgba(0,68,148,0.3); }
        .comp-symbol { font-size: 0.8rem; opacity: 0.8; letter-spacing: 1px; }
        .comp-name { font-size: 1.4rem; font-weight: 800; margin-top: 5px; line-height: 1.2; }
        .comp-arrow { align-self: flex-end; font-size: 1.2rem; color: var(--accent); }

        /* NOTÍCIAS */
        .section-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 25px; border-bottom: 2px solid #e0e0e0; padding-bottom: 15px; }
        .section-title { border-left: 5px solid var(--accent); padding-left: 15px; color: #222; margin: 0; font-size: 1.6rem; font-weight: 800; }
        .last-update { font-size: 0.8rem; color: #888; background: #eee; padding: 4px 10px; border-radius: 20px; }
        .news-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 30px; }
        .news-card { background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 5px 15px rgba(0,0,0,0.05); transition: 0.3s; display: flex; flex-direction: column; height: 100%; border: 1px solid #eee; }
        .news-card:hover { transform: translateY(-7px); box-shadow: 0 15px 30px rgba(0,0,0,0.1); }
        .news-img-container { height: 200px; width: 100%; background: #f0f0f0; overflow: hidden; }
        .news-img { width: 100%; height: 100%; object-fit: cover; transition: transform 0.5s; }
        .news-card:hover .news-img { transform: scale(1.05); }
        .news-content { padding: 25px; flex-grow: 1; display: flex; flex-direction: column; }
        .news-tag { color: var(--primary); font-size: 0.75rem; font-weight: 800; text-transform: uppercase; margin-bottom: 10px; letter-spacing: 0.5px; }
        .news-title { font-size: 1.15rem; font-weight: 700; margin-bottom: 12px; color: #222; line-height: 1.4; display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical; overflow: hidden; }
        .news-footer { margin-top: auto; padding-top: 15px; border-top: 1px solid #f5f5f5; display: flex; justify-content: space-between; align-items: center; color: #888; font-size: 0.8rem; }

        /* CALCULADORA */
        .tabs { display: flex; justify-content: center; margin-bottom: 30px; }
        .tab-btn { padding: 12px 30px; border: none; background: white; font-size: 1rem; font-weight: 600; color: #666; cursor: pointer; transition: 0.3s; border: 1px solid #ddd; margin: 0 5px; border-radius: 50px; }
        .tab-btn.active { background: var(--primary); color: white; border-color: var(--primary); box-shadow: 0 4px 10px rgba(0,68,148,0.3); }
        .tab-content { display: none; animation: fadeIn 0.5s; }
        .tab-content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .calc-wrapper { background: var(--white); border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.05); display: flex; flex-direction: column; overflow: hidden; margin-bottom: 40px; border: 1px solid #eee; }
        @media (min-width: 768px) { .calc-wrapper { flex-direction: row; } .form-side { width: 40%; border-right: 1px solid #eee; } .result-side { width: 60%; } }
        .padding-box { padding: 30px; }
        .input-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: 600; color: #555; font-size: 0.9rem; }
        input { width: 100%; padding: 12px; border: 2px solid #dfe6e9; border-radius: 8px; font-size: 16px; box-sizing: border-box; transition: 0.3s; }
        input:focus { border-color: var(--primary); outline: none; }
        .btn-calc { width: 100%; padding: 15px; background-color: var(--accent); color: #003366; border: none; border-radius: 8px; font-size: 18px; font-weight: 800; cursor: pointer; transition: 0.3s; margin-top: 10px; }
        .btn-calc:hover { background-color: #00b359; transform: translateY(-2px); }
        .btn-pdf { background-color: #dc3545; color: white; margin-top: 20px; font-size: 14px; padding: 10px; font-weight: 600; }
        .result-side { background-color: #fcfcfc; display: flex; flex-direction: column; }
        #results-area, #results-area-meta { display: none; }
        .big-number { text-align: center; margin-bottom: 15px; } .big-number span { display: block; font-weight: 800; } .big-number small { color: #888; text-transform: uppercase; font-size: 0.8rem; letter-spacing: 1px; }
        .extrato-box { background: #fff; border: 1px solid #eee; border-radius: 10px; padding: 20px; margin-bottom: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.03); }
        .extrato-row { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px dashed #eee; font-size: 0.95rem; color: #555; }
        .extrato-row.destaque { font-weight: bold; color: #333; font-size: 1rem; border-top: 2px solid #eee; margin-top: 5px; padding-top: 10px; border-bottom: none; }
        .val-red { color: var(--danger); font-weight: 500; } .val-orange { color: var(--warning); font-weight: 500; }
        #msgPoupanca { background-color: #d4edda; color: #155724; padding: 15px; border-radius: 8px; font-size: 0.9rem; margin-bottom: 20px; text-align: center; display: none; border: 1px solid #c3e6cb; }
        .table-wrapper { margin-top: 20px; max-height: 300px; overflow-y: auto; border: 1px solid #eee; border-radius: 8px; }
        table { width: 100%; border-collapse: collapse; font-size: 0.85rem; background: white; }
        th { background: #e9ecef; position: sticky; top: 0; padding: 10px; text-align: right; color: #555; z-index: 1; font-weight: 700; }
        td { padding: 8px 10px; text-align: right; border-bottom: 1px solid #f1f1f1; color: #666; }
        tr:nth-child(even) { background-color: #f8f9fa; }
        th:first-child, td:first-child { text-align: center; }
        td.rend-mes { color: var(--secondary); font-weight: 600; }
        .chart-container { position: relative; height: 250px; width: 100%; margin-top: 10px; }
        .seo-article { background: var(--white); padding: 40px; border-radius: 15px; box-shadow: 0 5px 20px rgba(0,0,0,0.03); color: #444; margin-top: 40px; }
        .seo-article h2 { color: #0056b3; border-left: 5px solid var(--primary); padding-left: 15px; margin-top: 30px; }
        .ad-slot { background: #eee; border: 1px dashed #ccc; text-align: center; padding: 15px; margin: 20px 0; font-size: 0.8rem; color: #999; display: flex; align-items: center; justify-content: center; }
        footer { text-align: center; padding: 40px; color: #888; font-size: 0.9rem; border-top: 1px solid #ddd; margin-top: 40px; background: white; }
        
        .toggles-area { background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px; border: 1px solid #eee; }
        .toggle-group { margin-bottom: 12px; }
        .toggle-label { display: flex; align-items: center; cursor: pointer; font-size: 0.95rem; color: #555; gap: 10px; }
        .toggle-label input { margin: 0; width: 18px; height: 18px; cursor: pointer; }
        .tooltip { position: relative; display: inline-block; cursor: help; color: var(--primary); font-weight: bold; width: 18px; height: 18px; text-align: center; border-radius: 50%; border: 1px solid var(--primary); font-size: 12px; line-height: 16px; margin-left: 8px; }
        .tooltip .tooltiptext { visibility: hidden; width: 220px; background-color: #333; color: #fff; text-align: left; border-radius: 6px; padding: 10px; position: absolute; z-index: 10; bottom: 125%; left: 50%; margin-left: -110px; opacity: 0; transition: opacity 0.3s; font-size: 0.8rem; font-weight: normal; }
        .tooltip:hover .tooltiptext { visibility: visible; opacity: 1; }
    </style>
</head>
<body>

<div class="stock-ticker-wrap">
    <div class="stock-ticker" id="stockTicker"><span class="stock-item">Carregando mercado...</span></div>
</div>

<header>
    <div class="header-content">
        <a href="index.html" class="logo-area">
            <img src="logo.png" id="logoSite" alt="JurosWeb">
            <span>JurosWeb</span>
        </a>
        <div class="search-bar">
            <input type="text" id="campoBusca" placeholder="Pesquisar notícias (ex: Petrobras, Dólar)...">
            <i class="fas fa-search" onclick="realizarBusca()"></i>
        </div>
        <div class="nav-links">
            <a href="index.html" class="active">Início</a>
            <a href="#noticias">Notícias</a>
            <a href="utilidades.html" class="btn-cta">Simuladores</a>
        </div>
    </div>
</header>

<div class="container">

    <div class="ad-slot" style="height: 90px;">Publicidade Topo</div>

    <div class="tabs">
        <button class="tab-btn active" onclick="openTab('rendimento')"><i class="fas fa-chart-line"></i> Juros Compostos</button>
        <button class="tab-btn" onclick="openTab('meta')"><i class="fas fa-bullseye"></i> Minha Meta</button>
    </div>

    <div id="rendimento" class="tab-content active">
        <div class="calc-wrapper">
            <div class="form-side padding-box">
                <div class="input-group">
                    <label>Valor Inicial</label>
                    <input type="text" id="valorInicial" class="money-input" placeholder="R$ 0,00" inputmode="numeric">
                </div>
                <div class="input-group">
                    <label>Aporte Mensal</label>
                    <input type="text" id="aporteMensal" class="money-input" placeholder="R$ 0,00" inputmode="numeric">
                </div>
                <div class="input-group">
                    <label>Taxa Anual (%)</label>
                    <input type="number" id="taxaJuros" placeholder="10.5" inputmode="decimal">
                </div>
                <div class="input-group">
                    <label>Anos</label>
                    <input type="number" id="anos" placeholder="5" inputmode="numeric">
                </div>
                
                <div class="toggles-area">
                    <div class="toggle-group">
                        <label class="toggle-label">
                            <input type="checkbox" id="checkIR">
                            <span>Descontar Imposto de Renda</span>
                        </label>
                    </div>
                    <div class="toggle-group">
                        <label class="toggle-label">
                            <input type="checkbox" id="checkInflacao">
                            <span>Descontar Inflação (IPCA)</span>
                            <div class="tooltip">?
                                <span class="tooltiptext">Remove o efeito da inflação para mostrar o "Poder de Compra Real".</span>
                            </div>
                        </label>
                    </div>
                    <div id="boxInflacao" style="display:none; margin-top:10px; padding-left: 28px;">
                        <label style="font-size: 0.8rem;">IPCA Esperado (% a.a.)</label>
                        <input type="number" id="taxaInflacao" value="4.5" step="0.1">
                    </div>
                </div>

                <button class="btn-calc" onclick="calcularRendimento()">SIMULAR AGORA</button>
            </div>

            <div class="result-side padding-box">
                <div id="intro-rendimento" style="text-align: center; color: #999; margin-top: 50px;">
                    <i class="fas fa-calculator" style="font-size: 3rem; margin-bottom: 15px; opacity: 0.3;"></i>
                    <p>Preencha os valores para ver a mágica dos juros.</p>
                </div>
                
                <div id="results-area">
                    <h3 style="margin-top:0; color: #444; text-align: center;">Resultado</h3>
                    <div class="big-number">
                        <small>Saldo Final Bruto</small>
                        <span id="resTotalBruto" style="color: var(--primary); font-size: 2.2rem;">R$ 0,00</span>
                    </div>
                    <div class="extrato-box">
                        <div class="extrato-row"><span>Investido</span><span id="resInvestido">R$ 0,00</span></div>
                        <div class="extrato-row"><span>Rendimento</span><span id="resBrutoJuros" style="color: var(--accent);">R$ 0,00</span></div>
                        <div id="rowIR" class="extrato-row" style="display:none;"><span>(-) Imposto de Renda</span><span id="resIR" class="val-red">- R$ 0,00</span></div>
                        <div id="rowInflacao" class="extrato-row" style="display:none;"><span>(i) Perda Inflacionária</span><span id="resInflacao" class="val-orange">- R$ 0,00</span></div>
                        <div class="extrato-row destaque" style="background:#f9f9f9; padding:10px;"><span>Poder de Compra Real</span><span id="resTotalLiquido">R$ 0,00</span></div>
                    </div>
                    
                    <div class="chart-container"><canvas id="chartRendimento"></canvas></div>
                    
                    <h4 style="margin-top:20px; color:#555;">Evolução Mensal</h4>
                    <div class="table-wrapper">
                        <table id="tabelaEvolucao">
                            <thead><tr><th>Mês</th><th>Investido</th><th>Rend. Mês</th><th>Total</th></tr></thead>
                            <tbody></tbody>
                        </table>
                    </div>

                    <button class="btn-calc btn-pdf" onclick="gerarPDF('rendimento')"><i class="fas fa-file-pdf"></i> BAIXAR RELATÓRIO</button>
                </div>
            </div>
        </div>
    </div>

    <div id="meta" class="tab-content">
        <div class="calc-wrapper">
            <div class="form-side padding-box">
                <div class="input-group"><label>Objetivo (R$)</label><input type="text" id="metaValor" class="money-input" placeholder="R$ 1.000.000,00"></div>
                <div class="input-group"><label>Prazo (Anos)</label><input type="number" id="metaAnos" placeholder="10"></div>
                <div class="input-group"><label>Já tenho (Opcional)</label><input type="text" id="metaInicial" class="money-input" placeholder="R$ 0,00"></div>
                <div class="input-group"><label>Rentabilidade (%)</label><input type="number" id="metaTaxa" placeholder="10"></div>
                <button class="btn-calc" onclick="calcularMeta()">CALCULAR APORTE</button>
            </div>
            <div class="result-side padding-box">
                <div id="intro-meta" style="text-align: center; color: #999; margin-top: 50px;">
                    <p>Defina seu sonho e descubra o plano.</p>
                </div>
                <div id="results-area-meta">
                    <div style="text-align: center; margin-bottom: 20px;">
                        <small>Você precisa investir por mês:</small>
                        <span id="resMetaMensal" style="display:block; font-size: 2rem; font-weight: 800; color: var(--accent);">R$ 0,00</span>
                    </div>
                    <div class="chart-container"><canvas id="chartMeta"></canvas></div>
                    <button class="btn-calc btn-pdf" onclick="gerarPDF('meta')">BAIXAR PLANO</button>
                </div>
            </div>
        </div>
    </div>

    <div class="companies-section">
        <div class="section-header">
            <h2 class="section-title">Empresas da Bolsa</h2>
            <a href="#" style="color:var(--primary); font-weight:bold; text-decoration:none;">Ver todas →</a>
        </div>
        <div class="comp-grid">
            <a href="https://www.google.com/finance/quote/VALE3:BVMF" target="_blank" class="comp-card"><div><div class="comp-symbol">VALE3</div><div class="comp-name">Vale S.A</div></div><div class="comp-arrow"><i class="fas fa-chart-line"></i></div></a>
            <a href="https://www.google.com/finance/quote/PETR4:BVMF" target="_blank" class="comp-card" style="background: linear-gradient(135deg, #006633 0%, #004d26 100%);"><div><div class="comp-symbol">PETR4</div><div class="comp-name">Petrobras</div></div><div class="comp-arrow"><i class="fas fa-chart-line"></i></div></a>
            <a href="https://www.google.com/finance/quote/ITUB4:BVMF" target="_blank" class="comp-card" style="background: linear-gradient(135deg, #ec7000 0%, #c45d00 100%);"><div><div class="comp-symbol">ITUB4</div><div class="comp-name">Itaú Unibanco</div></div><div class="comp-arrow"><i class="fas fa-chart-line"></i></div></a>
            <a href="https://www.google.com/finance/quote/BBAS3:BVMF" target="_blank" class="comp-card" style="background: linear-gradient(135deg, #f8f200 0%, #dad500 100%); color:#003366;"><div><div class="comp-symbol">BBAS3</div><div class="comp-name">Banco do Brasil</div></div><div class="comp-arrow" style="color:#003366;"><i class="fas fa-chart-line"></i></div></a>
        </div>
    </div>

    <div id="noticias" class="news-section">
        <div class="section-header">
            <h2 class="section-title" id="newsTitle">Últimas do Mercado</h2>
            <span class="last-update" id="lastUpdate">Atualizando...</span>
        </div>
        <div class="news-grid" id="newsGrid"><p style="padding:20px; color:#999;">Carregando notícias...</p></div>
    </div>

    <div class="ad-slot" style="height: 90px;">Publicidade Rodapé</div>

    <footer>
        <p>&copy; 2026 JurosWeb.com.br</p>
        <p style="margin-top: 10px;"><a href="politica.html" style="color: #999; text-decoration: none;">Política de Privacidade</a></p>
    </footer>

</div>

<script>
    // --- 1. NOTÍCIAS (COM BUSCA FUNCIONAL) ---
    async function carregarNoticias(termoBusca = '') {
        // Se usuário digitou, usa o termo. Se não, usa o padrão.
        let query = termoBusca ? termoBusca : 'investimentos bolsa economia brasil';
        
        // Atualiza o título da seção para dar feedback
        const titulo = document.getElementById('newsTitle');
        titulo.innerText = termoBusca ? `Resultados para: "${termoBusca}"` : 'Últimas do Mercado';

        const rssUrl = `https://news.google.com/rss/search?q=${encodeURIComponent(query)}&hl=pt-BR&gl=BR&ceid=BR:pt-419`;
        const apiUrl = `https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(rssUrl)}`;
        
        const backups = ['https://images.unsplash.com/photo-1611974765270-ca1258634369?auto=format&fit=crop&w=600&q=80', 'https://images.unsplash.com/photo-1590283603385-17ffb3a7f29f?auto=format&fit=crop&w=600&q=80', 'https://images.unsplash.com/photo-1633158829585-23ba8f7c8caf?auto=format&fit=crop&w=600&q=80', 'https://images.unsplash.com/photo-1579621970563-ebec7560ff3e?auto=format&fit=crop&w=600&q=80', 'https://images.unsplash.com/photo-1460925895917-afdab827c52f?auto=format&fit=crop&w=600&q=80', 'https://images.unsplash.com/photo-1554224155-6726b3ff858f?auto=format&fit=crop&w=600&q=80'];

        try {
            // Mostra "Buscando..." se for uma pesquisa
            if(termoBusca) document.getElementById('newsGrid').innerHTML = '<p style="padding:20px; color:#666;">Pesquisando...</p>';

            const response = await fetch(apiUrl);
            const data = await response.json();
            const grid = document.getElementById('newsGrid');
            grid.innerHTML = ''; 
            
            if(data.items.length === 0) {
                grid.innerHTML = '<p style="padding:20px; color:#666;">Nenhuma notícia encontrada para este termo.</p>';
                return;
            }

            data.items.slice(0, 6).forEach((item, index) => {
                const card = document.createElement('div');
                card.className = 'news-card';
                const dataPub = new Date(item.pubDate).toLocaleDateString('pt-BR', {day: '2-digit', month: 'long'});
                let imgUrl = item.enclosure?.link || item.thumbnail || backups[index % backups.length];
                card.innerHTML = `<a href="${item.link}" target="_blank" style="text-decoration:none; color:inherit; display:flex; flex-direction:column; height:100%;"><div class="news-img-container"><img src="${imgUrl}" class="news-img" onerror="this.onerror=null;this.src='${backups[index % backups.length]}';" alt="Notícia"></div><div class="news-content"><div class="news-tag">Mercado</div><div class="news-title">${item.title}</div><div class="news-footer"><span><i class="far fa-calendar-alt"></i> ${dataPub}</span><span>Ler mais →</span></div></div></a>`;
                grid.appendChild(card);
            });
            document.getElementById('lastUpdate').innerText = 'Atualizado agora';
        } catch (erro) { console.error(erro); }
    }

    // Função ativada pelo clique na Lupa ou Enter
    function realizarBusca() {
        let input = document.getElementById('campoBusca');
        let termo = input.value.trim();
        if (termo) {
            carregarNoticias(termo);
            // Rola suavemente até a seção de notícias
            document.getElementById('noticias').scrollIntoView({ behavior: 'smooth' });
        }
    }

    // Permitir busca com tecla Enter
    document.getElementById('campoBusca').addEventListener('keypress', function (e) {
        if (e.key === 'Enter') {
            realizarBusca();
        }
    });

    // --- 2. TICKER ---
    function loadTicker() {
        const stocks = [{t: 'IBOV', v: '128.500', up: true}, {t: 'PETR4', v: '38,50', up: false}, {t: 'VALE3', v: '68,20', up: true}, {t: 'ITUB4', v: '33,10', up: true}, {t: 'DOLAR', v: '5,15', up: true}, {t: 'BITCOIN', v: '250.000', up: true}, {t: 'CDI', v: '10,75%', up: true}, {t: 'IPCA', v: '4,50%', up: false}, {t: 'WEGE3', v: '25,40', up: true}, {t: 'BBAS3', v: '27,90', up: false}];
        let html = '';
        const loopStocks = [...stocks, ...stocks, ...stocks]; 
        loopStocks.forEach(s => {
            let variacao = (Math.random() * 2).toFixed(2);
            let arrow = s.up ? '▲' : '▼';
            let colorClass = s.up ? 'stock-up' : 'stock-down';
            html += `<span class="stock-item">${s.t} R$ ${s.v} <span class="${colorClass}">${arrow} ${variacao}%</span></span>`;
        });
        document.getElementById('stockTicker').innerHTML = html;
    }

    window.onload = function() { carregarNoticias(); loadTicker(); };

    // --- 3. CALCULADORA (MANTIDA) ---
    const moneyInputs = document.querySelectorAll('.money-input');
    moneyInputs.forEach(input => {
        input.addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if(value === '') return;
            value = (parseInt(value) / 100).toFixed(2) + '';
            value = value.replace('.', ',');
            value = value.replace(/(\d)(?=(\d{3})+(?!\d))/g, '$1.');
            e.target.value = 'R$ ' + value;
        });
    });
    function parseMoney(str) {
        if (!str) return 0;
        return parseFloat(str.replace(/[^\d,]/g, '').replace(',', '.')) || 0;
    }

    let chartRend = null;
    let chartMetaInst = null;
    let globalTableData = [];
    let pdfData = { bruto: 0, ir: 0, inflacao: 0, liquido: 0, investido: 0, nominal: 0 };

    function openTab(tabName) {
        document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(tabName).classList.add('active');
        if(event && event.target) event.target.closest('button').classList.add('active');
    }

    function calcularRendimento() {
        let P = parseMoney(document.getElementById('valorInicial').value);
        let M = parseMoney(document.getElementById('aporteMensal').value);
        let taxaAnual = parseFloat(document.getElementById('taxaJuros').value) || 0;
        let anos = parseFloat(document.getElementById('anos').value) || 0;
        let usarIR = document.getElementById('checkIR').checked;
        let usarInflacao = document.getElementById('checkInflacao').checked;

        if (anos <= 0) return alert("Informe o período em anos.");

        let meses = anos * 12;
        let i = (Math.pow(1 + (taxaAnual / 100), 1 / 12) - 1); 
        let labels = [];
        let dataInvestido = [];
        let dataBruto = [];
        globalTableData = []; 
        let totalInvestido = P;
        let saldoBruto = P;
        
        for(let m = 0; m <= meses; m++) {
            let rendimentoMensal = 0;
            if (m > 0) {
                rendimentoMensal = saldoBruto * i;
                saldoBruto = saldoBruto + rendimentoMensal + M;
                totalInvestido += M;
            }
            if (m % 6 === 0 || m === meses) { 
                labels.push(m);
                dataInvestido.push(totalInvestido);
                dataBruto.push(saldoBruto);
            }
            if (m > 0) {
                globalTableData.push([m, totalInvestido.toLocaleString('pt-BR', {style: 'currency', currency: 'BRL'}), rendimentoMensal.toLocaleString('pt-BR', {style: 'currency', currency: 'BRL'}), saldoBruto.toLocaleString('pt-BR', {style: 'currency', currency: 'BRL'})]);
            }
        }

        const tbody = document.querySelector('#tabelaEvolucao tbody');
        tbody.innerHTML = ''; 
        const fragment = document.createDocumentFragment();
        globalTableData.forEach(row => {
            const tr = document.createElement('tr');
            tr.innerHTML = `<td>${row[0]}</td><td>${row[1]}</td><td class="rend-mes">+ ${row[2]}</td><td><strong>${row[3]}</strong></td>`;
            fragment.appendChild(tr);
        });
        tbody.appendChild(fragment);

        let lucroBruto = saldoBruto - totalInvestido;
        let valorIR = 0;
        let valorPerdaInflacao = 0;
        let saldoLiquidoNominal = saldoBruto; 
        
        if (usarIR) {
            let dias = meses * 30;
            let aliquotaIR = 0.15;
            if (dias <= 180) aliquotaIR = 0.225;
            else if (dias <= 360) aliquotaIR = 0.20;
            else if (dias <= 720) aliquotaIR = 0.175;
            valorIR = lucroBruto * aliquotaIR;
            saldoLiquidoNominal = saldoBruto - valorIR;
            
            document.getElementById('rowIR').style.display = 'flex';
            document.getElementById('resIR').innerText = '- ' + valorIR.toLocaleString('pt-BR', {style: 'currency', currency: 'BRL'});
        } else {
            document.getElementById('rowIR').style.display = 'none';
        }

        if(usarInflacao) {
            document.getElementById('boxInflacao').style.display = 'block';
            let inflacaoRate = parseFloat(document.getElementById('taxaInflacao').value) || 4.5;
            let deflator = Math.pow(1 + (inflacaoRate / 100), anos);
            let saldoReal = saldoLiquidoNominal / deflator;
            valorPerdaInflacao = saldoLiquidoNominal - saldoReal;
            
            document.getElementById('rowInflacao').style.display = 'flex';
            document.getElementById('resInflacao').innerText = '- ' + valorPerdaInflacao.toLocaleString('pt-BR', {style: 'currency', currency: 'BRL'});
            document.getElementById('resTotalLiquido').innerText = saldoReal.toLocaleString('pt-BR', {style: 'currency', currency: 'BRL'});
        } else {
            document.getElementById('boxInflacao').style.display = 'none';
            document.getElementById('rowInflacao').style.display = 'none';
            document.getElementById('resTotalLiquido').innerText = saldoLiquidoNominal.toLocaleString('pt-BR', {style: 'currency', currency: 'BRL'});
        }

        const fmt = new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' });
        document.getElementById('resInvestido').innerText = fmt.format(totalInvestido);
        document.getElementById('resBrutoJuros').innerText = fmt.format(saldoBruto - totalInvestido);
        document.getElementById('resTotalBruto').innerText = fmt.format(saldoLiquidoNominal); 
        
        document.getElementById('intro-rendimento').style.display = 'none';
        document.getElementById('results-area').style.display = 'block';

        const ctx = document.getElementById('chartRendimento').getContext('2d');
        if (chartRend) chartRend.destroy();
        chartRend = new Chart(ctx, { type: 'line', data: { labels: labels, datasets: [{ label: 'Saldo Total', data: dataBruto, borderColor: '#004494', backgroundColor: 'rgba(0,68,148,0.1)', fill: true, pointRadius: 0 }, { label: 'Investido', data: dataInvestido, borderColor: '#999', backgroundColor: 'transparent', borderDash: [5,5], pointRadius: 0 }] }, options: { responsive: true, maintainAspectRatio: false, scales: { x: {display:false} } } });
        
        pdfData = { bruto: fmt.format(saldoBruto), nominal: fmt.format(saldoLiquidoNominal), investido: fmt.format(totalInvestido), ir: usarIR ? '- ' + fmt.format(valorIR) : 'Isento', inflacao: usarInflacao ? '- ' + fmt.format(valorPerdaInflacao) : 'Não calc.', liquido: document.getElementById('resTotalLiquido').innerText };
    }

    function calcularMeta() {
        let objetivo = parseMoney(document.getElementById('metaValor').value);
        let anos = parseFloat(document.getElementById('metaAnos').value);
        let inicial = parseMoney(document.getElementById('metaInicial').value);
        let taxaAnual = parseFloat(document.getElementById('metaTaxa').value);
        if (!objetivo || !anos || !taxaAnual) return alert("Preencha os campos obrigatórios.");
        let meses = anos * 12;
        let i = (Math.pow(1 + (taxaAnual / 100), 1 / 12) - 1);
        let fator = Math.pow(1 + i, meses);
        let futuroInicial = inicial * fator;
        let falta = objetivo - futuroInicial;
        let aporte = falta > 0 ? falta / ((fator - 1) / i) : 0;
        const fmt = new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' });
        document.getElementById('resMetaMensal').innerText = fmt.format(aporte);
        document.getElementById('intro-meta').style.display = 'none';
        document.getElementById('results-area-meta').style.display = 'block';
        const ctx = document.getElementById('chartMeta').getContext('2d');
        if (chartMetaInst) chartMetaInst.destroy();
        let labels=[], data=[], saldo=inicial;
        for(let m=0; m<=meses; m++) { if(m%6===0 || m===meses) { labels.push(m); data.push(saldo); } saldo = saldo*(1+i)+aporte; }
        chartMetaInst = new Chart(ctx, { type: 'line', data: { labels: labels, datasets: [{ label: 'Evolução', data: data, borderColor: '#00d26a', backgroundColor: 'rgba(0,210,106,0.1)', fill: true }] }, options: { responsive: true, maintainAspectRatio: false, elements:{point:{radius:0}}, scales:{x:{display:false}} } });
    }

    function getLogoBase64() {
        return new Promise((resolve) => {
            const img = document.getElementById('logoSite');
            if (!img || !img.complete || img.naturalHeight === 0) { resolve(null); return; }
            const canvas = document.createElement("canvas"); canvas.width = img.naturalWidth; canvas.height = img.naturalHeight; const ctx = canvas.getContext("2d"); ctx.drawImage(img, 0, 0); try { resolve(canvas.toDataURL("image/png")); } catch(e) { resolve(null); }
        });
    }

    async function gerarPDF(tipo) {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        const logoData = await getLogoBase64();
        if (logoData) { doc.addImage(logoData, 'PNG', 15, 10, 40, 0); } else { doc.setFont("helvetica", "bold"); doc.setFontSize(22); doc.setTextColor(0, 86, 179); doc.text("JurosWeb", 15, 25); }
        doc.setFont("helvetica", "normal"); doc.setFontSize(10); doc.setTextColor(100); doc.text(`Gerado em: ${new Date().toLocaleDateString()}`, 150, 20); doc.line(15, 35, 195, 35); 
        let startY = 45; 
        if (tipo === 'rendimento') {
            doc.setFontSize(14); doc.setTextColor(0); doc.text("Relatório de Rendimento", 15, startY);
            doc.setFontSize(11); doc.text(`Total Investido: ${pdfData.investido}`, 20, startY + 10); doc.text(`Saldo Final (Nominal): ${pdfData.nominal}`, 20, startY + 18);
            if (pdfData.ir !== 'Isento') { doc.setTextColor(220, 53, 69); doc.text(`Imposto de Renda: ${pdfData.ir}`, 20, startY + 26); }
            if (pdfData.inflacao !== 'Não calc.') { doc.setTextColor(230, 126, 34); doc.text(`Perda Inflacionária: ${pdfData.inflacao}`, 20, startY + 34); doc.setTextColor(40, 167, 69); doc.setFont("helvetica", "bold"); doc.text(`Poder de Compra Real: ${pdfData.liquido}`, 20, startY + 44); } else { doc.text(`Total Final: ${pdfData.nominal}`, 20, startY + 34); }
            const canvas = document.getElementById('chartRendimento'); const ctx = canvas.getContext('2d'); ctx.globalCompositeOperation = 'destination-over'; ctx.fillStyle = "white"; ctx.fillRect(0, 0, canvas.width, canvas.height); const imgData = canvas.toDataURL('image/png'); doc.addImage(imgData, 'PNG', 25, startY + 55, 160, 90);
            doc.setTextColor(0); doc.setFont("helvetica", "bold"); doc.text("Evolução Mensal", 15, startY + 155); doc.autoTable({ startY: startY + 160, head: [['Mês', 'Investido', 'Rend. Mês', 'Total']], body: globalTableData, theme: 'grid', headStyles: { fillColor: [0, 86, 179] }, styles: { fontSize: 9 }, margin: { top: 20 } });
        } else {
            let meta = document.getElementById('txtMetaAlvo').innerText; let aporte = document.getElementById('resMetaMensal').innerText;
            doc.setFontSize(14); doc.setTextColor(0); doc.text("Planejamento de Meta", 15, startY); doc.setFontSize(12); doc.text(`Objetivo: ${meta}`, 20, startY + 15); doc.text(`Investir Mensalmente: ${aporte}`, 20, startY + 25);
            const canvas = document.getElementById('chartMeta'); const ctx = canvas.getContext('2d'); ctx.fillStyle = "white"; ctx.fillRect(0, 0, canvas.width, canvas.height); const imgData = canvas.toDataURL('image/png'); doc.addImage(imgData, 'PNG', 25, startY + 35, 160, 90);
        }
        doc.save("Relatorio-JurosWeb.pdf");
    }
</script>

</body>
</html>
